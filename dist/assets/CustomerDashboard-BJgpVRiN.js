import{j as e,C as M,y as p,h as L,G as R,u as E,i as q,U as A,R as D,k as P}from"./index-esxET7c2.js";import{r as a,u as F,L as H}from"./vendor-D4ShCMrl.js";import{L as I}from"./GetLocationName-PAHvRiGe.js";import{m as B}from"./data-BWyo1Etn.js";function O({open:b,onClose:j,data:s}){const[c,r]=a.useState(""),[d,x]=a.useState(""),[m,h]=a.useState(""),[u,l]=a.useState(!1),[i,g]=a.useState("");a.useEffect(()=>{const n=async()=>{try{const o=await(await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${s==null?void 0:s.latitude}&lon=${s==null?void 0:s.longitude}`)).json(),{road:y,suburb:N,city:v,town:w,state:S,country:k}=o.address||{},C=[y,N||v||w,S||k].filter(Boolean).join(", ");h(C||"Unknown location")}catch{h("Unable to fetch location")}};s!=null&&s.latitude&&(s!=null&&s.longitude)&&n()},[s==null?void 0:s.latitude,s==null?void 0:s.longitude]);const t=async n=>{if(n.preventDefault(),!c){alert("Please select a service");return}if(!d.trim()){alert("Please enter a description");return}const f={serviceType:c,address:m,location:{coordinates:[s.longitude,s.latitude]},description:d,mechanicId:(s==null?void 0:s.mechanicId)||null};try{l(!0),g("");const o=await M(f);if(o.error){g(o.error||"Failed to create request");return}g("Request created successfully!"),x(""),r("")}catch(o){console.error(o),g("Failed to create request")}finally{l(!1)}};return b?e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black/50 z-50",children:e.jsxs("div",{className:"bg-gray-800 rounded-xl shadow-xl w-96 p-5",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Request a Service"}),e.jsxs("form",{onSubmit:t,className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Select Service"}),e.jsxs("select",{value:c,onChange:n=>r(n.target.value),className:"w-full border text-black rounded-lg px-3 py-2",children:[e.jsx("option",{value:"",className:"text-black",children:"-- Select Service --"}),B.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description"}),e.jsx("textarea",{value:d,onChange:n=>x(n.target.value),rows:3,className:"w-full border rounded-lg px-3 py-2 text-black",placeholder:"Describe the issue..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Location"}),e.jsx("input",{type:"text",readOnly:!0,value:m||"Detecting location...",className:"w-full border rounded-lg px-3 py-2 bg-gray-50"})]}),e.jsx("button",{type:"submit",className:"w-full bg-yellow-600 text-white py-2 rounded-lg hover:bg-yellow-400 disabled:bg-yellow-600",disabled:u||!m||!c||!d.trim(),children:u?"Submitting...":"Submit Request"})]}),i&&e.jsx("p",{className:"mt-3 text-center text-sm text-green-600",children:i}),e.jsx("button",{onClick:j,className:"mt-3 w-full bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300",children:"Close"})]})}):null}function U(){const[b,j]=a.useState([]),[s,c]=a.useState(!1),[r,d]=a.useState({latitude:null,longitude:null}),[x,m]=a.useState(!1),[h,u]=a.useState();a.useEffect(()=>{"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(({coords:t})=>{d({latitude:t.latitude,longitude:t.longitude})},t=>{console.error("Error getting location:",t),p.error("Unable to get your location")})},[]),a.useEffect(()=>{r.latitude&&r.longitude&&l(r.latitude,r.longitude)},[r]);const l=async(t,n)=>{var f;c(!0);try{const o={latitude:t,longitude:n},y=await L(t,n);j(((f=y==null?void 0:y.data)==null?void 0:f.mechanics)||[])}catch(o){console.error("Error fetching data:",o),p.error("Failed to load mechanics")}finally{c(!1)}},i=t=>async()=>{try{const n=await R(t)}catch{}},g=async t=>{const n={longitude:r.longitude,latitude:r.latitude,mechanicId:t};u(n),m(!0)};return e.jsxs("div",{className:"p-4",children:[s&&e.jsx("p",{children:"Loading mechanics near you..."}),!s&&b.length===0&&e.jsx("p",{children:"No mechanics available in your area."}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:b.map(t=>e.jsxs("div",{className:"w-full bg-gray-800 p-6 rounded-xl shadow",children:[e.jsx("div",{className:"flex justify-between items-center mb-3",children:e.jsx("h3",{className:"text-yellow-400 font-semibold text-lg",children:t.fullName})}),e.jsxs("p",{className:"text-gray-400 mb-1",children:["üîß ",t.expertise||"Car Mechanic"]}),e.jsxs("p",{className:"text-gray-400 mb-1",children:["üìû",t.phone]}),e.jsxs("p",{className:"text-gray-400 mb-1",children:[" üìç",t.location&&e.jsx(I,{lat:t.location.coordinates[1],lon:t.location.coordinates[0]}),"‚Ä¢ ",t.distance]}),e.jsxs("div",{className:"flex justify-between items-center mt-3 mb-4",children:[e.jsxs("span",{className:"text-yellow-400",children:["‚≠ê ",t.totalRatings]}),e.jsx("span",{className:"text-gray-400 text-sm",children:"Verified ‚úÖ"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"btn btn-primary w-full",onClick:()=>g(t.id),children:"Book Now"}),e.jsx("button",{className:"btn btn-secondary w-full",onClick:i(t._id),children:"View Profile"})]})]},t.id))}),e.jsx(O,{open:x,onClose:()=>m(!1),data:h})]})}function W(){var u;const{user:b}=E(),[j,s]=a.useState(""),c=F(),{setSelectedMechanic:r,clearSelectedMechanic:d}=q(),[x,m]=a.useState();a.useEffect(()=>{d()},[]);const h=l=>()=>{r(l),c("/map")};return a.useEffect(()=>{const l=async()=>{const i=await P();m(i.data)};return()=>{l()}},[]),e.jsxs("div",{className:"fade-in min-h-screen bg-gray-900 text-white",children:[e.jsx("header",{className:"bg-gray-950 py-4 shadow",children:e.jsxs("div",{className:"container mx-auto flex justify-between items-center px-4",children:[e.jsx("h1",{className:"text-yellow-400 text-2xl font-semibold",children:"üîß Elisoft Assist"}),e.jsxs("div",{className:"hidden justify-center items-center md:flex",children:["            ",e.jsxs(H,{to:"/profile",className:"flex flex-col items-center text-gray-400 hover:text-yellow-500 transition",children:[e.jsx(A,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"Profile"})]})]})]})}),e.jsxs("main",{className:"container mx-auto px-4 py-10 space-y-20",children:[e.jsxs("section",{className:"grid md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"bg-gradient-to-tr from-yellow-400 to-yellow-500 text-black rounded-xl p-6 shadow",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üó∫Ô∏è"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"Find on Map"}),e.jsx("p",{className:"text-gray-800 mb-4",children:"Locate mechanics near you with our interactive map"}),e.jsx("button",{onClick:()=>c("/map"),className:"bg-black text-yellow-400 px-5 py-2 rounded hover:bg-gray-800 transition",children:"Open Map"})]}),e.jsxs("div",{className:"bg-gray-800 rounded-xl p-6 text-center",children:[e.jsx("div",{className:"text-4xl mb-4",children:"üìû"}),e.jsx("h3",{className:"text-yellow-400 text-xl font-bold mb-2",children:"Emergency Service"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Need immediate roadside assistance?"}),e.jsx("button",{className:"btn btn-danger",children:"Call Emergency"})]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"mb-6 flex flex-col md:flex-row items-start md:items-center justify-between gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400",children:"üîç Find Mechanics"}),e.jsx("input",{type:"text",className:"input w-full md:w-[400px] px-4 py-2 rounded bg-gray-800 text-white",placeholder:"Search by location, service, or name...",value:j,onChange:l=>s(l.target.value)})]}),e.jsx(U,{})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-6",children:"üìã Your Appointments"}),e.jsx("div",{className:"grid md:grid-cols-2 gap-6",children:(u=x==null?void 0:x.serviceRequests)==null?void 0:u.map(l=>{var i;return e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl",children:[e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx("h3",{className:"text-yellow-400 font-semibold",children:(i=l.mechanicId)==null?void 0:i.fullName}),e.jsx("span",{className:`text-sm px-3 py-1 rounded-full ${l.status==="Completed"?"bg-green-600":"bg-yellow-500 text-black"}`,children:l.status})]}),e.jsxs("div",{className:"grid grid-cols-2 text-sm text-gray-300 gap-2 mb-4",children:[e.jsxs("p",{children:["üîß Service: ",l.serviceType]}),e.jsxs("p",{children:["üìÖ Requested: ",new Date(l.requestedAt).toLocaleString()]}),e.jsxs("p",{children:["üìç Address: ",l.address]}),e.jsxs("p",{children:["üí∞ Payment: ",l.paymentMethod," (",l.paymentStatus,")"]})]}),l.status==="Pending"&&e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{className:"btn btn-secondary w-full",onClick:()=>h(l.mechanicId),children:"View on Map"}),e.jsx("button",{className:"btn btn-danger w-full",children:"Cancel"})]})]},l.id)})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-2xl font-bold text-yellow-400 mb-6",children:"üì¶ Service Options"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üè™"}),e.jsx("h3",{className:"text-yellow-400 text-lg font-bold mb-2",children:"Workshop Visit"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Bring your vehicle to our partner workshops for expert service"}),e.jsx("button",{className:"btn btn-primary",children:"Find Workshop"})]}),e.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üè†"}),e.jsx("h3",{className:"text-yellow-400 text-lg font-bold mb-2",children:"Home Service"}),e.jsx("p",{className:"text-gray-400 mb-4",children:"Let our professionals come to your location for convenient repairs"}),e.jsx("button",{className:"btn btn-primary",children:"Request Home Service"})]})]})]})]}),e.jsx("div",{className:"mt-20 visible md:hidden",children:e.jsx(D,{})})]})}export{W as default};
