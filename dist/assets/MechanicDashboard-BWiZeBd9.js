import{j as e,l as h,m as f,n as y,y as u,o as g,p as v,U as j,R as N,q as b}from"./index-esxET7c2.js";import{r as n,u as x,L as S}from"./vendor-D4ShCMrl.js";function w(){const[i,d]=n.useState([]),[r,p]=n.useState([]),[m,l]=n.useState(!1);n.useEffect(()=>{let s=!0;return(async()=>{var a;l(!0);try{const t=await h();s&&d(((a=t==null?void 0:t.data)==null?void 0:a.availableRequests)||[])}catch(t){console.error("âŒ Failed to fetch mechanic requests:",t)}finally{s&&l(!1)}})(),()=>{s=!1}},[]),n.useEffect(()=>{let s=!0;return(async()=>{var a;l(!0);try{const t=await f();s&&p(((a=t==null?void 0:t.data)==null?void 0:a.availableRequests)||[])}catch(t){console.error("âŒ Failed to fetch pending requests:",t)}finally{s&&l(!1)}})(),()=>{s=!1}},[]);const c=async s=>{var o;try{l(!0);const a=localStorage.getItem("token"),t=await y.post(`https://elisoft-backend.onrender.com/api/service-requests/${s}/accept`,{},{headers:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""}});return u.success("âœ… Job accepted successfully! Customer has been notified."),t.data}catch(a){a.response?(console.error("âŒ Server responded with error:",a.response.data),u.error(((o=a.response.data)==null?void 0:o.message)||"Failed to accept job.")):a.request?(console.error("ðŸ“¡ No response from server:",a.request),u.error("No response from server. Please check your connection.")):(console.error("âš™ï¸ Request setup error:",a.message),u.error("Error setting up request."))}finally{l(!1)}};return e.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center w-full",children:[m?e.jsx("p",{children:"Loading Job Requests..."}):(i==null?void 0:i.length)===0?e.jsx("p",{children:"No Job Requests Available"}):null,i==null?void 0:i.map(s=>{var o;return e.jsxs("div",{className:"card w-full",children:[e.jsxs("div",{className:"flex-between",style:{marginBottom:"15px"},children:[e.jsx("h3",{style:{color:"#FFD700",fontSize:"1.3rem"},children:(o=s==null?void 0:s.customerId)==null?void 0:o.fullName}),e.jsx("span",{className:`status-badge ${s.priority==="Medium"?"status-blocked":"status-pending"}`,children:s.priority})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ”§ Service: ",s.serviceType]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ“… Date: ",new Date(s.updatedAt).toLocaleString()]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ“ Location: ",s.address]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ“ Distance: ",s.distance]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ’° Payment: ",s.estimatedPrice]}),e.jsxs("p",{style:{color:"#ccc"},children:[" ðŸ“ Duration",s.duration]})]}),e.jsx("div",{className:"d",children:e.jsxs("p",{style:{color:"#ccc"},children:["  Description: ",s.description]})}),e.jsxs("div",{className:"flex",style:{gap:"12px"},children:[e.jsx("button",{onClick:()=>c(s._id),className:"btn btn-primary",style:{flex:1},children:"Accept Job"}),e.jsx("button",{onClick:()=>handleRejectJob(s.id),className:"btn btn-secondary",style:{flex:1},children:"Decline"})]})]},s==null?void 0:s._id)})]})}function q(){const[i,d]=n.useState(!1),[r,p]=n.useState([]),m=x();n.useEffect(()=>{let s=!0;return(async()=>{var a;d(!0);try{const t=await g();s&&p(((a=t==null?void 0:t.data)==null?void 0:a.acceptedRequests)||[])}catch(t){console.error(t)}finally{s&&d(!1)}})(),()=>{s=!1}},[]);const l=async s=>{d(!0),await v(s,{status:"Completed"}),d(!1)},c=s=>{console.log(s),m("/map",{state:{job:s}})};return e.jsxs("div",{className:"grid md:grid-cols-2 gap-12 items-center",children:[i?e.jsx("p",{className:"text-white",children:"Loading Accepted Jobs..."}):null,r==null?void 0:r.map(s=>e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex-between",style:{marginBottom:"15px"},children:[e.jsx("h3",{style:{color:"#FFD700",fontSize:"1.3rem"},children:s.customerId.fullName}),e.jsx("span",{className:`status-badge ${s.status==="Completed"?"status-completed":"status-pending"}`,children:s.paymentStatus})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"20px"},children:[e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ”§ Service: ",s.serviceType]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ“… Date: ",s.requestedAt]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ“ Location: ",s.address]}),e.jsxs("p",{style:{color:"#ccc"},children:["ðŸ’° Payment: ",s.finalPrice]})]}),s.status==="Accepted"&&e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{onClick:()=>l(s.id),className:"btn btn-primary",style:{flex:1},children:"Mark Complete"}),e.jsx("button",{onClick:()=>c(s),className:"btn btn-secondary",style:{flex:1},children:"View On Map"})]}),s.status==="Completed"&&e.jsx("div",{className:"text-center",children:e.jsx("span",{style:{color:"#00FF00",fontWeight:"500"},children:"âœ… Job Completed Successfully"})})]},s.id))]})}function R({user:i,onLogout:d}){const[r,p]=n.useState(()=>{const c=localStorage.getItem("mechanicAvailability");return c?JSON.parse(c):!1}),m=x(),l=async()=>{try{const c=!r,s=await b({isAvailable:c});p(c),localStorage.setItem("mechanicAvailability",JSON.stringify(c)),u.success(c?"You are now available!":"You are now unavailable!")}catch(c){console.error("Error toggling availability:",c),u.error("Failed to update availability")}};return e.jsxs("div",{className:" fade-in flex justify-center items-center flex-col w-full ",children:[e.jsx("header",{className:"bg-dark flex w-full justify-center mt-4",children:e.jsxs("div",{className:"container  flex justify-between",children:[e.jsx("div",{children:e.jsx("h1",{style:{color:"#FFD700",fontSize:"1.8rem"},children:"ðŸ”§  Elisoft Assist"})}),e.jsxs("div",{className:"hidden justify-center items-center md:flex",children:["            ",e.jsxs(S,{to:"/profile",className:"flex flex-col items-center text-gray-400 hover:text-yellow-500 transition",children:[e.jsx(j,{className:"w-6 h-6"}),e.jsx("span",{className:"text-xs mt-1",children:"Profile"})]})]})]})}),e.jsxs("div",{className:"container",style:{padding:"40px 20px"},children:[e.jsx("section",{style:{marginBottom:"60px"},children:e.jsx("div",{className:"grid md:grid-cols-1 gap-12 items-center",children:e.jsxs("div",{className:"card",children:[e.jsx("h2",{style:{fontSize:"1.5rem",marginBottom:"20px",color:"#FFD700"},children:"ðŸ”„ Availability Status"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 justify-between  gap-4 ",style:{alignItems:"center",marginBottom:"20px"},children:[e.jsxs("span",{style:{color:"#ccc",fontSize:"1.1rem"},onClick:()=>l(),children:["Currently:"," ",e.jsx("strong",{style:{color:r?"#00FF00":"#FF4444"},children:r?"Available":"Unavailable"})]}),e.jsxs("div",{className:"flex gap-4 w-full justify-end",children:[e.jsx("button",{onClick:()=>l(),className:` btn ${r?"btn-danger":"btn-primary"}`,style:{padding:"8px 16px"},children:r?"Go Offline":"Go Online"}),e.jsx("button",{onClick:()=>m("/map"),className:"btn",style:{backgroundColor:"#000",color:"#FFD700",border:"none"},children:"View Map"})]})]})]})})}),e.jsxs("section",{style:{marginBottom:"60px"},children:[e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"30px",color:"#FFD700"},children:"ðŸ“¨ New Job Requests"}),e.jsx(w,{})]}),e.jsxs("section",{style:{marginBottom:"60px"},children:[e.jsx("h2",{style:{fontSize:"2rem",marginBottom:"30px",color:"#FFD700"},children:"âœ… Your Active Jobs"}),e.jsx(q,{})]})]}),e.jsx(N,{})]})}export{R as default};
