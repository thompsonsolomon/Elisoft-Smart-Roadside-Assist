import{j as e,b as E,y as o,u as O,R as I,d as R,e as M,g as F}from"./index-esxET7c2.js";import{r as c,L as k}from"./vendor-D4ShCMrl.js";import{L as S}from"./GetLocationName-PAHvRiGe.js";function V(){const[t,f]=c.useState(!1),[s,y]=c.useState(""),[a,h]=c.useState(""),[w,N]=c.useState(""),[g,u]=c.useState(""),[d,p]=c.useState(!1),b=async()=>{var i,j;if(p(!0),a.length<4){u("PIN must be at least 4 digits");return}if(a!==w){u("New PIN and Confirm PIN do not match");return}u("");try{const v=await E({currentPin:s,newPin:a});if(((i=v.response)==null?void 0:i.data.status)==="error"){o.error((j=v.response)==null?void 0:j.data.message),p(!1);return}o.success("password update successfully"),f(!1)}catch{o.error("Failed to update PIN")}finally{p(!1),y(""),h(""),N("")}};return e.jsxs("div",{className:"flex justify-center items-center",children:[e.jsx("div",{className:"w-full mt-3",children:e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-700",children:"Change PIN"})}),t&&e.jsx("div",{className:"fixed inset-0 flex justify-center items-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg w-96 p-6 relative",children:[e.jsx("h2",{className:"text-xl font-bold mb-4 text-yellow-500 text-center",children:"Change PIN"}),g&&e.jsx("p",{className:"text-red-500 text-sm mb-2 text-center",children:g}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("input",{placeholder:"Old PIN",value:s,type:"password",onChange:i=>{/^\d*$/.test(i.target.value)&&y(i.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-yellow-300"}),e.jsx("input",{type:"password",placeholder:"New PIN",value:a,onChange:i=>{/^\d*$/.test(i.target.value)&&h(i.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-yellow-300"}),e.jsx("input",{type:"password",placeholder:"Confirm New PIN",value:w,onChange:i=>{/^\d*$/.test(i.target.value)&&N(i.target.value)},className:"w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring focus:ring-yellow-300"})]}),e.jsxs("div",{className:"flex justify-end gap-3 mt-6",children:[e.jsx("button",{onClick:()=>f(!1),className:"px-4 py-2 bg-gray-300 rounded-lg hover:bg-gray-400",children:"Cancel"}),e.jsx("button",{onClick:b,className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700",children:d?"loading..":"Save"})]})]})})]})}const B=["Roadside Assistant","Mechanic Repair","Towing Service","Electric Rewire / Battery Jumpstart","Flat Tyre","Car Service Center","Body Repair","Break Repair","Car AC Repair","Engine Diagnostic","Wheel Alignment","Oil Change","Body Painting","Key Lockout"];function Y(){var P;const{user:t,logout:f}=O(),[s,y]=c.useState(t||null),[a,h]=c.useState({name:(t==null?void 0:t.fullName)||"",phone:(t==null?void 0:t.phone)||"",address:(t==null?void 0:t.address)||"",services:Array.isArray(t==null?void 0:t.services)?t.services:[],yearsOfExperience:(t==null?void 0:t.yearsOfExperience)||"",licenseNumber:(t==null?void 0:t.licenseNumber)||"",accountNumber:(t==null?void 0:t.accountNumber)||"",bankName:(t==null?void 0:t.bankName)||"",bankCode:(t==null?void 0:t.bankCode)||"",accountName:(t==null?void 0:t.accountName)||"",role:(t==null?void 0:t.role)||"Mechanic"}),[w,N]=c.useState(!1),[g,u]=c.useState(!1),[d,p]=c.useState({latitude:null,longitude:null}),b=(P=t==null?void 0:t.role)==null?void 0:P.toLowerCase();c.useEffect(()=>{let l=!0;return(async()=>{var r,x;N(!0);try{const m=await R();l&&((x=(r=m==null?void 0:m.data)==null?void 0:r.user)!=null&&x.user)&&y(m.data.user.user)}catch(m){console.error("Error fetching user:",m)}finally{l&&N(!1)}})(),()=>{l=!1}},[]),c.useEffect(()=>{let l=!0;return"geolocation"in navigator?navigator.geolocation.getCurrentPosition(({coords:n})=>{l&&p({latitude:n.latitude,longitude:n.longitude})},n=>{console.error("Error getting location:",n),o.warn("Unable to fetch location. Please allow location access.")},{enableHighAccuracy:!0,timeout:1e4,maximumAge:0}):o.error("Geolocation is not supported on this device."),()=>{l=!1}},[]);const i=l=>{const{name:n,value:r}=l.target;h(x=>({...x,[n]:r}))},j=l=>{const{value:n,checked:r}=l.target;h(x=>{const m=new Set(x.services||[]);return r?m.add(n):m.delete(n),{...x,services:Array.from(m)}})},C=async l=>{var n;if((n=l==null?void 0:l.preventDefault)==null||n.call(l),!d.latitude||!d.longitude){o.error("Location not available. Please allow GPS access.");return}u(!0);try{const r={location:{type:"Point",coordinates:[Number(d.longitude),Number(d.latitude)]}},x=await M(r);o.success(x.message||"ðŸ“ Location updated successfully!")}catch(r){console.error("Error updating location:",r),o.error("âŒ Failed to update location")}finally{u(!1)}},v=async l=>{l.preventDefault(),u(!0);try{const n={fullName:a.name,phone:a.phone,address:a.address,services:a.services,yearsOfExperience:a.yearsOfExperience,licenseNumber:a.licenseNumber,accountNumber:a.accountNumber,bankName:a.bankName,bankCode:a.bankCode,accountName:a.accountName,role:a.role},r=await F(n);localStorage.setItem("Elisoft Assist_user",JSON.stringify(r.data.user)),o.success(r.message||"âœ… Profile updated successfully!")}catch(n){console.error("Error updating profile:",n),o.error("âŒ Failed to update profile")}finally{u(!1)}},A=()=>{h({name:(s==null?void 0:s.fullName)||"",phone:(s==null?void 0:s.phone)||"",address:(s==null?void 0:s.address)||"",services:Array.isArray(s==null?void 0:s.services)?s.services:[],yearsOfExperience:(s==null?void 0:s.yearsOfExperience)||"",licenseNumber:(s==null?void 0:s.licenseNumber)||"",accountNumber:(s==null?void 0:s.accountNumber)||"",bankName:(s==null?void 0:s.bankName)||"",bankCode:(s==null?void 0:s.bankCode)||"",accountName:(s==null?void 0:s.accountName)||"",role:(s==null?void 0:s.role)||"Mechanic"}),o.info("ðŸ”„ Form reset to current profile")},L={basic:1,standard:3,premium:"Unlimited"}[s==null?void 0:s.currentPlan]||1;return e.jsxs("div",{className:"min-h-screen bg-black py-8 px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center justify-between mb-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsx(k,{to:`/${t==null?void 0:t.role}`,className:"text-sm text-gray-600 hover:text-gray-900",children:e.jsx("h1",{className:"text-xl font-extrabold tracking-tight text-white",children:"Profile"})})}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:f,className:"text-sm font-medium text-yellow-600 hover:text-yellow-700",children:"Logout"})})]}),e.jsxs("div",{className:"max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-12 gap-8",children:[e.jsxs("div",{className:"lg:col-span-5 space-y-6",children:[e.jsxs("div",{className:"rounded-2xl overflow-hidden bg-gradient-to-br from-yellow-500 via-orange-400 to-pink-500 p-6 shadow-2xl relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-tr from-black/10 to-transparent pointer-events-none"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-20 h-20 rounded-full ring-4 ring-white overflow-hidden shadow-lg bg-white/30 flex items-center justify-center",children:e.jsx("img",{src:"placeholder-user.jpg",alt:"Profile",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"text-white",children:[e.jsx("h2",{className:"text-2xl font-bold leading-tight",children:(s==null?void 0:s.fullName)||"John Doe"}),e.jsx("p",{className:"text-sm opacity-90",children:(s==null?void 0:s.role)||"Mechanic"}),e.jsxs("div",{className:"mt-2 text-xs bg-white/20 py-1 px-3 rounded-full inline-flex items-center gap-2",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"w-3 h-3",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{d:"M10 2a6 6 0 00-6 6v1H3a1 1 0 000 2h1v1a6 6 0 006 6 6 6 0 006-6v-1h1a1 1 0 000-2h-1V8a6 6 0 00-6-6z"})}),e.jsx("span",{children:s!=null&&s.isPhoneVerified?"Verified":"Not Verified"})]})]})]}),e.jsxs("div",{className:"mt-6 grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/20 rounded-lg p-3 text-white",children:[e.jsx("p",{className:"text-xs",children:"Joined"}),e.jsx("p",{className:"text-sm font-semibold",children:s!=null&&s.createdAt?new Date(s.createdAt).toLocaleDateString():"N/A"})]}),e.jsxs("div",{className:"bg-white/20 rounded-lg p-3 text-white",children:[e.jsx("p",{className:"text-xs",children:"Availability"}),e.jsx("p",{className:"text-sm font-semibold",children:s!=null&&s.isAvailable?"Available":"Unavailable"})]})]})]}),e.jsxs("div",{className:"card shadow p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-white mb-4",children:"User Bio"}),b==="mechanic"?e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-200",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-200",children:"License"}),e.jsx("p",{className:"font-medium",children:(s==null?void 0:s.licenseNumber)||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-200",children:"Verified"}),e.jsx("p",{className:"font-medium",children:s!=null&&s.isPhoneVerified?"Yes":"No"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-200",children:"Status"}),e.jsx("p",{className:"font-medium",children:s!=null&&s.status?"Active":"Pending"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-200",children:"Joined"}),e.jsx("p",{className:"font-medium",children:s!=null&&s.createdAt?new Date(s.createdAt).toDateString():"N/A"})]})]}):e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 text-sm text-gray-700",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Plan"}),e.jsx("p",{className:"font-medium",children:(s==null?void 0:s.currentPlan)||"N/A"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Verified"}),e.jsx("p",{className:"font-medium",children:s!=null&&s.isPhoneVerified?"Yes":"No"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-xs text-gray-400",children:"Free Assistance"}),e.jsx("p",{className:"font-medium",children:(s==null?void 0:s.currentPlan)==="premium"?"Unlimited":`${(s==null?void 0:s.firstAssistance)||0} / ${L}`})]})]}),e.jsxs("div",{className:" mt-6 flex  w-full justify-between items-center",children:[e.jsx(k,{to:"/payment",className:"px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-700",children:s!=null&&s.role.includes("Mechanic")?"Payment":"Subscription"}),e.jsx(V,{})]})]}),e.jsxs("div",{className:"card shadow p-6",children:[e.jsxs("div",{className:"flex flex-col gap-5 items-start justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-semibold text-white",children:"Location"}),e.jsx("p",{className:"text-xs text-gray-200 mt-1",children:"Update your current coordinates for quicker service matching."})]}),e.jsx("div",{className:"text-sm text-gray-100",children:e.jsx(S,{lat:d.latitude,lon:d.longitude})})]}),e.jsxs("div",{className:"mt-4 flex gap-3",children:[e.jsx("button",{onClick:C,className:"flex-1 inline-flex items-center justify-center gap-2 rounded-lg py-2 px-3 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold",children:g?"Updating...":"Set Current Location"}),e.jsx("button",{onClick:()=>{var l,n;(n=(l=navigator.geolocation)==null?void 0:l.getCurrentPosition)==null||n.call(l,({coords:r})=>{p({latitude:r.latitude,longitude:r.longitude}),o.success("Coordinates refreshed")})},className:"inline-flex items-center justify-center gap-2 rounded-lg py-2 px-3 border border-gray-200 bg-white text-gray-700",children:"Refresh"})]})]})]}),e.jsx("div",{className:"lg:col-span-7 space-y-6",children:e.jsxs("form",{onSubmit:v,className:"space-y-6",children:[e.jsxs("div",{className:"card rounded-2xl shadow p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Personal Info"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white block mb-2",children:"Full name"}),e.jsx("input",{name:"name",value:a.name,onChange:i,className:"w-full border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-white block mb-2",children:"Phone number"}),e.jsx("input",{name:"phone",value:a.phone,onChange:i,className:"w-full border border-gray-200 rounded px-3 py-2 focus:outline-none  focus:ring-yellow-300"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"text-sm text-white block mb-2",children:"Address"}),e.jsx("div",{className:"w-full border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-300",children:e.jsx(S,{lat:d.latitude,lon:d.longitude})})]})]})]}),b==="mechanic"&&e.jsxs("div",{className:"card shadow p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-200",children:"Services & Experience"}),e.jsx("p",{className:"text-sm text-gray-200",children:"Select services you offer"})]}),e.jsx("div",{className:"mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 max-h-56 overflow-y-auto",children:B.map(l=>{const n=(a.services||[]).includes(l);return e.jsxs("label",{className:"flex items-center gap-3 p-3 border rounded-lg hover:shadow",children:[e.jsx("input",{type:"checkbox",value:l,checked:n,onChange:j,className:"w-4 h-4"}),e.jsx("span",{className:"text-sm text-gray-100",children:l})]},l)})}),e.jsxs("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-100 block mb-2",children:"Years of experience"}),e.jsx("input",{name:"yearsOfExperience",type:"number",value:a.yearsOfExperience,onChange:i,className:"w-full border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-300"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-100 block mb-2",children:"License number"}),e.jsx("input",{name:"licenseNumber",value:a.licenseNumber,onChange:i,className:"w-full border border-gray-200 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-yellow-300"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{type:"submit",disabled:g,className:"flex-1 bg-gradient-to-r from-yellow-500 to-orange-400 hover:from-yellow-600 hover:to-orange-500 text-white font-semibold py-3 rounded-xl shadow-lg",children:g?"Saving...":"Save Profile"}),e.jsx("button",{type:"button",onClick:()=>{A()},className:"px-4 py-3 border rounded-xl bg-white text-gray-700",children:"Reset"})]})]})})]}),e.jsx("div",{className:"mt-20 visible md:hidden",children:e.jsx(I,{})})]})}export{Y as default};
